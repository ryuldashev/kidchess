<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <script>
        // Redirect /research to Docsify (Cloudflare SPA workaround)
        if (location.pathname.startsWith('/research')) {
            location.replace('/research/index.html' + location.hash);
        }
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4a7c59">
    <title>Sticky Chess</title>
    <!-- Telegram WebApp SDK (safe to load in browser, does nothing) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Symbols+2&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <!-- Umami Analytics -->
    <script defer data-website-id="3af78e55-bbbb-4f55-aba0-0eb505508fcc" src="https://kidchess-umami.fly.dev/script.js"></script>
</head>
<body class="theme-green">
    <div id="app">
        <!-- Pack Selection Screen -->
        <div id="pack-select-screen" class="screen active">
            <div class="pack-header">
                <button id="theme-toggle" class="theme-toggle" aria-label="–í—ã–∫–ª—é—á–∏—Ç—å –Ω–æ—á–Ω–æ–π —Ä–µ–∂–∏–º">
                    üåô
                </button>
                <div class="pack-logo">
                    <span class="pack-logo-icon">‚ôò</span>
                    <span class="pack-logo-text">sticky chess</span>
                </div>
                <p class="pack-subtitle">–í—ã–±–µ—Ä–∏ –Ω–∞–±–æ—Ä –∑–∞–¥–∞—á–µ–∫!</p>
            </div>
            <div id="pack-grid"></div>
            <div class="pack-footer">
                <p>üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –¥–µ—Ç–µ–π –æ—Ç 3 –ª–µ—Ç</p>
                <a href="https://t.me/stickychessbot" class="telegram-link">
                    <span class="telegram-icon">‚úàÔ∏è</span> –ò–≥—Ä–∞—Ç—å –≤ Telegram
                </a>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <!-- Header -->
            <div id="header">
                <button id="back-btn" aria-label="Back">
                    <svg viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </button>
                <div id="level-info">
                    <div id="level-top">
                        <span id="level-number">–ó–∞–¥–∞—á–∞ 1</span>
                        <span id="progress">0/20</span>
                    </div>
                    <div id="puzzle-title">–ú–∞—Ç –≤ 1 —Ö–æ–¥</div>
                </div>
                <button id="menu-btn" aria-label="Menu">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </button>
            </div>

            <!-- Board Container -->
            <div id="board-container">
                <div id="board"></div>
            </div>

            <!-- Hint Block (under board, always visible) -->
            <div id="hint-block">
                <span class="hint-avatar">ü¶ä</span>
                <p id="hint-text">–ù–∞–∂–º–∏ –Ω–∞ –º–µ–Ω—è –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏!</p>
            </div>

            <!-- Controls -->
            <div id="controls">
                <button id="prev-btn" class="control-btn" title="–ü—Ä–µ–¥—ã–¥—É—â–∞—è">
                    <svg viewBox="0 0 24 24">
                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                    </svg>
                </button>
                <button id="report-btn" class="control-btn" title="–ñ–∞–ª–æ–±–∞">
                    <span class="btn-emoji">üëé</span>
                </button>
                <button id="next-btn" class="control-btn" title="–°–ª–µ–¥—É—é—â–∞—è">
                    <svg viewBox="0 0 24 24">
                        <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/>
                    </svg>
                </button>
            </div>

        </div>
    </div>

    <!-- Status Message -->
    <div id="status-message"></div>

    <!-- Menu Overlay -->
    <div id="menu-overlay">
        <button id="close-menu">&times;</button>
        <button class="menu-item" data-action="restart"><span class="menu-icon">üîÑ</span> –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        <button class="menu-item" data-action="prev"><span class="menu-icon">‚¨ÖÔ∏è</span> –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <button class="menu-item" data-action="next"><span class="menu-icon">‚û°Ô∏è</span> –°–ª–µ–¥—É—é—â–∞—è</button>
        <button class="menu-item" data-action="packs"><span class="menu-icon">üì¶</span> –í—ã–±—Ä–∞—Ç—å –Ω–∞–±–æ—Ä</button>
        <button class="menu-item" data-action="reset"><span class="menu-icon">üóëÔ∏è</span> –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
    </div>

    <!-- Report Modal -->
    <div id="report-modal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">‚ö†Ô∏è</div>
            <h3>–°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ?</h3>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="Game.closeReportModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-primary" onclick="Game.sendReport()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal">
        <div class="modal-content result-modal">
            <div id="result-icon" class="result-icon">üéâ</div>
            <h2 id="result-title">–ü–æ–±–µ–¥–∞!</h2>
            <div id="result-stats" class="result-stats">
                <div class="stat-item">
                    <span class="stat-value" id="stat-moves">0</span>
                    <span class="stat-label">—Ö–æ–¥–æ–≤</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-captures">0</span>
                    <span class="stat-label">–≤–∑—è—Ç–∏–π</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="Game.goBack()">–ö –≤—ã–±–æ—Ä—É</button>
                <button class="btn-primary" onclick="Game.restartAIGame()">–ï—â—ë —Ä–∞–∑</button>
            </div>
        </div>
    </div>

    <!-- PRO Modal (Fake Door) -->
    <div id="pro-modal" class="modal">
        <div class="modal-content pro-modal">
            <!-- Main content -->
            <div id="pro-content" class="pro-content">
                <div class="pro-icon">üëë</div>
                <h2>KidChess PRO</h2>
                <p class="pro-subtitle">–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!</p>

                <div class="pro-features">
                    <div class="pro-feature">
                        <span class="pro-feature-icon">üì¶</span>
                        <span class="pro-feature-text">99 —É—Ä–æ–≤–Ω–µ–π –∏ –∫–≤–µ—Å—Ç–æ–≤</span>
                    </div>
                    <div class="pro-feature">
                        <span class="pro-feature-icon">üéì</span>
                        <span class="pro-feature-text">–û–±—É—á–∞—é—â–∏–µ –∫–≤–µ—Å—Ç—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏</span>
                    </div>
                    <div class="pro-feature">
                        <span class="pro-feature-icon">üÜï</span>
                        <span class="pro-feature-text">–ù–æ–≤—ã–µ –ø–∞–∫–∏ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü</span>
                    </div>
                    <div class="pro-feature">
                        <span class="pro-feature-icon">üèÜ</span>
                        <span class="pro-feature-text">–ü—É—Ç—å –∫ —á–µ–º–ø–∏–æ–Ω—Å—Ç–≤—É</span>
                    </div>
                </div>

                <div class="pro-price">$3.99</div>
                <p class="pro-price-period">–≤ –º–µ—Å—è—Ü</p>

                <button class="btn-pro" onclick="Game.handleProBuyClick()">–ö—É–ø–∏—Ç—å PRO</button>
                <button class="btn-secondary" onclick="Game.closeProModal()">–ù–µ —Å–µ–π—á–∞—Å</button>
            </div>

            <!-- Coming soon message (shown after buy click) -->
            <div id="pro-coming-soon" class="pro-coming-soon">
                <div class="pro-coming-soon-icon">üöÄ</div>
                <h3>–°–∫–æ—Ä–æ!</h3>
                <p>–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ PRO-–≤–µ—Ä—Å–∏–µ–π.<br>–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å!</p>
                <button class="btn-primary" onclick="Game.closeProModal()" style="margin-top: 20px;">–ü–æ–Ω—è—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <script src="js/chess.min.js"></script>
    <script src="js/telegram.js"></script>
    <script src="js/sounds.js"></script>
    <script src="js/puzzles.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/game.js"></script>
</body>
</html>
