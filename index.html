<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <script>
        // Redirect /research to Docsify (Cloudflare SPA workaround)
        if (location.pathname.startsWith('/research')) {
            location.replace('/research/index.html' + location.hash);
        }
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4a7c59">
    <title>KidChess</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Umami Analytics -->
    <script defer data-website-id="3af78e55-bbbb-4f55-aba0-0eb505508fcc" src="https://kidchess-umami.fly.dev/script.js"></script>
</head>
<body class="theme-green">
    <div id="app">
        <!-- Pack Selection Screen -->
        <div id="pack-select-screen" class="screen active">
            <div class="pack-header">
                <div class="pack-logo">
                    <span class="pack-logo-icon">‚ôü</span>
                    <span class="pack-logo-text">KidChess</span>
                </div>
                <p class="pack-subtitle">–í—ã–±–µ—Ä–∏ –Ω–∞–±–æ—Ä –∑–∞–¥–∞—á–µ–∫!</p>
            </div>
            <div id="pack-grid"></div>
            <div class="pack-footer">
                <p>üéØ –î–ª—è –¥–µ—Ç–µ–π –æ—Ç 3 –ª–µ—Ç</p>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <!-- Header -->
            <div id="header">
                <button id="back-btn" aria-label="Back">
                    <svg viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </button>
                <div id="level-info">
                    <div id="level-top">
                        <span id="level-number">–ó–∞–¥–∞—á–∞ 1</span>
                        <span id="progress">0/20</span>
                    </div>
                    <div id="puzzle-title">–ú–∞—Ç –≤ 1 —Ö–æ–¥</div>
                </div>
                <button id="menu-btn" aria-label="Menu">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </button>
            </div>

            <!-- Board Container -->
            <div id="board-container">
                <div id="board"></div>
            </div>

            <!-- Hint Block (under board, always visible) -->
            <div id="hint-block">
                <span class="hint-avatar">ü¶ä</span>
                <p id="hint-text">–ù–∞–∂–º–∏ –Ω–∞ –º–µ–Ω—è –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏!</p>
            </div>

            <!-- Controls -->
            <div id="controls">
                <button id="skip-btn" class="control-btn" title="Skip">
                    <svg viewBox="0 0 24 24">
                        <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                    </svg>
                </button>
                <button id="undo-btn" class="control-btn" title="Undo">
                    <svg viewBox="0 0 24 24">
                        <path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/>
                    </svg>
                </button>
                <button id="report-btn" class="control-btn" title="Report Error">
                    <svg viewBox="0 0 24 24">
                        <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                    </svg>
                </button>
            </div>

        </div>
    </div>

    <!-- Status Message -->
    <div id="status-message"></div>

    <!-- Menu Overlay -->
    <div id="menu-overlay">
        <button id="close-menu">&times;</button>
        <button class="menu-item" data-action="restart">Restart Puzzle</button>
        <button class="menu-item" data-action="next">Next Puzzle</button>
        <button class="menu-item" data-action="prev">Previous Puzzle</button>
        <button class="menu-item" data-action="random">Random Puzzle</button>
        <button class="menu-item" data-action="packs">Change Pack</button>
        <button class="menu-item" data-action="reset">Reset Progress</button>
    </div>

    <!-- Report Modal -->
    <div id="report-modal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">‚ö†Ô∏è</div>
            <h3>–û—à–∏–±–∫–∞ –≤ –∑–∞–¥–∞—á–µ?</h3>
            <p>–û–ø–∏—à–∏ –ø—Ä–æ–±–ª–µ–º—É:</p>
            <textarea id="report-text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è..."></textarea>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="Game.closeReportModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn-primary" onclick="Game.sendReport()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal">
        <div class="modal-content result-modal">
            <div id="result-icon" class="result-icon">üéâ</div>
            <h2 id="result-title">–ü–æ–±–µ–¥–∞!</h2>
            <div id="result-stats" class="result-stats">
                <div class="stat-item">
                    <span class="stat-value" id="stat-moves">0</span>
                    <span class="stat-label">—Ö–æ–¥–æ–≤</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-captures">0</span>
                    <span class="stat-label">–≤–∑—è—Ç–∏–π</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="Game.goBack()">–ö –≤—ã–±–æ—Ä—É</button>
                <button class="btn-primary" onclick="Game.restartAIGame()">–ï—â—ë —Ä–∞–∑</button>
            </div>
        </div>
    </div>

    <script src="js/chess.min.js"></script>
    <script src="js/sounds.js"></script>
    <script src="js/puzzles.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/game.js"></script>
</body>
</html>
